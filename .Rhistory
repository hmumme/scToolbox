pC_x = exp(llC) / sumLL # divide p(x|C) by sum
return(c(pA_x, pB_x, pC_x))
}
# calculate class probabilities for x = [5.0 5.0 1]
ClassProbability(c(5,5,1))
0.57 + 0.42
install.packages("devtools")
library(devtools)
library(bmi585hmumme)
devtools::install_github("hmumme/bmi585hmumme")
library(bmi585hmumme)
?chiSquareCounts
devtools::install_github("hmumme/bmi585hmumme")
devtools::install_github("hmumme/bmi585hmumme")
library(bmi585hmumme)
?chiSquareCounts
?accuracy
devtools::install_github("hmumme/bmi585hmumme")
bmi585hmumme
library(bmi585hmumme)
install.packages("pbkrtest")
library(KMsurv)
install.packages("KMsurv")
knitr::opts_chunk$set(echo = TRUE)
library(KMsurv)
install.packages("survMisc")
knitr::opts_chunk$set(echo = TRUE)
library(KMsurv)
library(survMisc)
data("bmt", package="KMsurv")
bmt
data("bmt", package="KMsurv")
head(bmt)
b1 <- bmt[bmt$group==1, ] # ALL patients
b1
c1 <- coxph(Surv(t2, d3) ~ z1, data=b1) # z1=age
c1
?Surv
c1 <- cutp(c1)$z1
c1
data("bmt", package="KMsurv")
head(bmt)
b1 <- bmt[bmt$group==1, ] # ALL patients
c1 <- coxph(Surv(t2, d3) ~ z1, data=b1) # z1=age
c1 <- cutp(c1)$z1
data.table::setorder(c1, "z1")
data("bmt", package="KMsurv")
head(bmt)
b1 <- bmt[bmt$group==1, ] # ALL patients
c1 <- coxph(Surv(t2, d3) ~ z1, data=b1) # z1=age
c1 <- cutp(c1)$z1
data.table::setorder(c1, "z1")
c1[]
knitr::opts_chunk$set(echo = TRUE)
library(Seurat)
library(SeuratDisk)
library(Seurat)
library(SeuratDisk)
install.packages(SeuratDisk)
if (!requireNamespace("remotes", quietly = TRUE)) {
install.packages("remotes")
}
remotes::install_github("mojaveazure/seurat-disk")
library(Seurat)
library(SeuratDisk)
library(SeuratWrappers)
install.packages(SeuratWrappers)
remotes::install_github('satijalab/seurat-wrappers')
install.packages("R.utils")
remotes::install_github('satijalab/seurat-wrappers')
library(SeuratWrappers)
library(patchwork)
library(harmony)
library(rliger)
library(reshape2)
library(RColorBrewer)
library(dplyr)
source("utils/custom_seurat_functions.R")
library(Seurat)
library(SeuratDisk)
library(SeuratWrappers)
library(patchwork)
library(harmony)
library(rliger)
library(reshape2)
library(RColorBrewer)
library(dplyr)
source("utils/custom_seurat_functions.R")
knitr::opts_chunk$set(echo = TRUE)
library(Seurat)
library(SeuratDisk)
library(SeuratWrappers)
library(patchwork)
library(harmony)
library(rliger)
library(reshape2)
library(RColorBrewer)
library(dplyr)
library(hdf5r)
library(ggplot2)
library(gridExtra)
source("utils/custom_seurat_functions.R")
download.file("https://cf.10xgenomics.com/samples/cell-exp/4.0.0/Parent_NGSC3_DI_PBMC/Parent_NGSC3_DI_PBMC_filtered_feature_bc_matrix.h5",
destfile = "data/3p_pbmc10k_filt.h5")
download.file("https://cf.10xgenomics.com/samples/cell-vdj/5.0.0/sc5p_v2_hs_PBMC_10k/sc5p_v2_hs_PBMC_10k_filtered_feature_bc_matrix.h5",
destfile = "data/5p_pbmc10k_filt.h5")
matrix_3p <- Read10X_h5("data/Parent_NGSC3_DI_PBMC_filtered_feature_bc_matrix.h5",use.names = T)
matrix_5p <- Read10X_h5("data/sc5p_v2_hs_PBMC_10k_filtered_feature_bc_matrix.h5")$`Gene Expression`
srat_3p   <- CreateSeuratObject(matrix_3p,project = "pbmc10k_3p")
srat_5p   <- CreateSeuratObject(matrix_5p,project = "pbmc10k_5p")
rm(matrix_3p)
rm(matrix_5p)
srat_3p[["percent.mt"]]  <- PercentageFeatureSet(srat_3p, pattern = "^MT-")
srat_3p[["percent.rbp"]] <- PercentageFeatureSet(srat_3p, pattern = "^RP[SL]")
srat_5p[["percent.mt"]]  <- PercentageFeatureSet(srat_5p, pattern = "^MT-")
srat_5p[["percent.rbp"]] <- PercentageFeatureSet(srat_5p, pattern = "^RP[SL]")
VlnPlot(srat_3p, features = c("nFeature_RNA","nCount_RNA","percent.mt","percent.rbp"), ncol = 4)
VlnPlot(srat_5p, features = c("nFeature_RNA","nCount_RNA","percent.mt","percent.rbp"), ncol = 4)
srat_3p <- subset(srat_3p, subset = nFeature_RNA > 500 & nFeature_RNA < 5000 & percent.mt < 15)
srat_5p <- subset(srat_5p, subset = nFeature_RNA > 500 & nFeature_RNA < 5000 & percent.mt < 10)
pbmc_list <- list()
pbmc_list[["pbmc10k_3p"]] <- srat_3p
pbmc_list[["pbmc10k_5p"]] <- srat_5p
for (i in 1:length(pbmc_list)) {
pbmc_list[[i]] <- NormalizeData(pbmc_list[[i]], verbose = F)
pbmc_list[[i]] <- FindVariableFeatures(pbmc_list[[i]], selection.method = "vst", nfeatures = 2000, verbose = F)
}
pbmc_anchors    <- FindIntegrationAnchors(object.list = pbmc_list, dims = 1:30)
pbmc_anchors
ls()
pbmc_anchors    <- FindIntegrationAnchors(object.list = pbmc_list, dims = 1:30)
gc()
pbmc_seurat     <- IntegrateData(anchorset = pbmc_anchors, dims = 1:30)
rm(pbmc_list)
rm(pbmc_anchors)
DefaultAssay(pbmc_seurat) <- "RNA"
pbmc_seurat <- NormalizeData(pbmc_seurat, verbose = F)
pbmc_seurat <- FindVariableFeatures(pbmc_seurat, selection.method = "vst", nfeatures = 2000, verbose = F)
pbmc_seurat <- ScaleData(pbmc_seurat, verbose = F)
pbmc_seurat <- RunPCA(pbmc_seurat, npcs = 30, verbose = F)
pbmc_seurat <- RunUMAP(pbmc_seurat, reduction = "pca", dims = 1:30, verbose = F)
pS_B = DimPlot(pbmc_seurat,reduction = "umap",group.by = "orig.ident") + ggtitle("10k 3' PBMC and 10k 5' PBMC cells, before integration")
pS_B
DefaultAssay(pbmc_seurat) <- "integrated"
pbmc_seurat <- ScaleData(pbmc_seurat, verbose = F)
pbmc_seurat <- RunPCA(pbmc_seurat, npcs = 30, verbose = F)
pbmc_seurat <- RunUMAP(pbmc_seurat, reduction = "pca", dims = 1:30, verbose = F)
pbmc_seurat <- FindNeighbors(pbmc_seurat, dims = 1:30, k.param = 10, verbose = F)
pbmc_seurat <- FindClusters(pbmc_seurat, verbose = F)
pS_I = DimPlot(pbmc_seurat, reduction = "umap",group.by = "orig.ident") + ggtitle("10k 3' PBMC and 10k 5' PBMC cells, after integration (Seurat 3)")
pS_I
DimPlot(pbmc_seurat,label = T, split.by = "orig.ident") + NoLegend() + ggtitle("Seurat Integrated Matrix Clusters")
pS = plot_integrated_clusters(pbmc_seurat) + ggtitle("Distribution of Datasets in Seurat Integrated Matrix Clusters")
pS
pbmc_harmony <- merge(srat_3p,srat_5p)
pbmc_harmony <- NormalizeData(pbmc_harmony, verbose = F)
pbmc_harmony <- FindVariableFeatures(pbmc_harmony, selection.method = "vst", nfeatures = 2000, verbose = F)
pbmc_harmony <- ScaleData(pbmc_harmony, verbose = F)
pbmc_harmony <- RunPCA(pbmc_harmony, npcs = 30, verbose = F)
pbmc_harmony <- RunUMAP(pbmc_harmony, reduction = "pca", dims = 1:30, verbose = F)
(pbmc_seurat@meta.data, orig.ident, res.0.8)
# Seurat ARI
ariS <- dplyr::select(pbmc_seurat@meta.data, orig.ident, res.0.8)
pbmc_seurat
colnames(pbmc_seurat)
colnames(pbmc_seurat@meta.data)
# Seurat ARI
ariS <- dplyr::select(pbmc_seurat@meta.data, orig.ident, integrated_snn_res.0.8)
ariS
table(pbmc_seurat$orig.ident)
ariS$orig.ident <- plyr::mapvalues(ariS$orig.ident, from = c("pbmc10k_3p","pbmc10k_5p"), to = c(0, 1))
adj.rand.index(as.numeric(ariS$orig.ident), as.numeric(ariS$res.0.8))
library(pdfCluster)
install.packages("pdfCluster")
library(pdfCluster)
adj.rand.index(as.numeric(ariS$orig.ident), as.numeric(ariS$res.0.8))
adj.rand.index(as.numeric(ariS$orig.ident), as.numeric(ariS$integrated_snn_res.0.8))
print(adj.rand.index(as.numeric(ariS$orig.ident), as.numeric(ariS$integrated_snn_res.0.8)))
print("SEURAT ARI=")
print(adj.rand.index(as.numeric(ariS$orig.ident), as.numeric(ariS$integrated_snn_res.0.8)))
pHL_B = DimPlot(pbmc_harmony,reduction = "umap", group.by="orig.ident") + plot_annotation(title = "10k 3' PBMC and 10k 5' PBMC cells, before integration")
pHL_B
pbmc_harmony <- merge(srat_3p,srat_5p)
pbmc_harmony <- NormalizeData(pbmc_harmony, verbose = F)
pbmc_harmony <- FindVariableFeatures(pbmc_harmony, selection.method = "vst", nfeatures = 2000, verbose = F)
pbmc_harmony <- ScaleData(pbmc_harmony, verbose = F)
pbmc_harmony <- RunPCA(pbmc_harmony, npcs = 30, verbose = F)
pbmc_harmony <- RunUMAP(pbmc_harmony, reduction = "pca", dims = 1:30, verbose = F)
pHL_B = DimPlot(pbmc_harmony,reduction = "umap", group.by="orig.ident") + plot_annotation(title = "10k 3' PBMC and 10k 5' PBMC cells, before integration")
pHL_B
pbmc_harmony <- pbmc_harmony %>% RunHarmony("orig.ident", plot_convergence = T)
p1 <- DimPlot(object = pbmc_harmony, reduction = "harmony", pt.size = .1, group.by = "orig.ident") + NoLegend()
p2 <- VlnPlot(object = pbmc_harmony, features = "harmony_1", group.by = "orig.ident", pt.size = .1) + NoLegend()
plot_grid(p1,p2)
pbmc_harmony <- pbmc_harmony %>%
RunUMAP(reduction = "harmony", dims = 1:30, verbose = F) %>%
FindNeighbors(reduction = "harmony", k.param = 10, dims = 1:30) %>%
FindClusters() %>%
identity()
pbmc_harmony <- SetIdent(pbmc_harmony,value = "orig.ident")
pH_I = DimPlot(pbmc_harmony,reduction = "umap",group.by="orig.ident") + plot_annotation(title = "10k 3' PBMC and 10k 5' PBMC cells, after integration (Harmony)")
pH_I
pH_I
ariS <- dplyr::select(pbmc_seurat@meta.data, orig.ident, integrated_snn_res.0.8)
ariS$orig.ident <- plyr::mapvalues(ariS$orig.ident, from = c("pbmc10k_3p","pbmc10k_5p"), to = c(0, 1))
print("SEURAT ARI =")
print(adj.rand.index(as.numeric(ariS$orig.ident), as.numeric(ariS$integrated_snn_res.0.8)))
print("---------------")
# Harmony ARI
ariH <- dplyr::select(pbmc_harmony@meta.data, orig.ident, integrated_snn_res.0.8)
colnames(pbmc_harmony@meta.data)
ariS <- dplyr::select(pbmc_seurat@meta.data, orig.ident, integrated_snn_res.0.8)
ariS$orig.ident <- plyr::mapvalues(ariS$orig.ident, from = c("pbmc10k_3p","pbmc10k_5p"), to = c(0, 1))
print("SEURAT ARI =")
print(adj.rand.index(as.numeric(ariS$orig.ident), as.numeric(ariS$integrated_snn_res.0.8)))
print("---------------")
# Harmony ARI
ariH <- dplyr::select(pbmc_harmony@meta.data, orig.ident, RNA_snn_res.0.8)
ariH$orig.ident <- plyr::mapvalues(ariH$orig.ident, from = c(""), to = c(0, 1))
ariS <- dplyr::select(pbmc_seurat@meta.data, orig.ident, integrated_snn_res.0.8)
ariS$orig.ident <- plyr::mapvalues(ariS$orig.ident, from = c("pbmc10k_3p","pbmc10k_5p"), to = c(0, 1))
print("SEURAT ARI =")
print(adj.rand.index(as.numeric(ariS$orig.ident), as.numeric(ariS$integrated_snn_res.0.8)))
print("---------------")
# Harmony ARI
ariH <- dplyr::select(pbmc_harmony@meta.data, orig.ident, RNA_snn_res.0.8)
ariH$orig.ident <- plyr::mapvalues(ariH$orig.ident, from = c("pbmc10k_3p","pbmc10k_5p"), to = c(0, 1))
print("HARMONY ARI =")
print(adj.rand.index(as.numeric(ariH$orig.ident), as.numeric(ariH$integrated_snn_res.0.8)))
ariS <- dplyr::select(pbmc_seurat@meta.data, orig.ident, integrated_snn_res.0.8)
ariS$orig.ident <- plyr::mapvalues(ariS$orig.ident, from = c("pbmc10k_3p","pbmc10k_5p"), to = c(0, 1))
print("SEURAT ARI =")
print(adj.rand.index(as.numeric(ariS$orig.ident), as.numeric(ariS$integrated_snn_res.0.8)))
print("---------------")
# Harmony ARI
ariH <- dplyr::select(pbmc_harmony@meta.data, orig.ident, RNA_snn_res.0.8)
ariH$orig.ident <- plyr::mapvalues(ariH$orig.ident, from = c("pbmc10k_3p","pbmc10k_5p"), to = c(0, 1))
print("HARMONY ARI =")
print(adj.rand.index(as.numeric(ariH$orig.ident), as.numeric(ariH$RNA_snn_res.0.8)))
print("---------------")
pbmc_liger <- merge(srat_3p,srat_5p)
pbmc_liger  <- NormalizeData(pbmc_liger)
pbmc_liger  <- FindVariableFeatures(pbmc_liger)
pbmc_liger  <- ScaleData(pbmc_liger, split.by = "orig.ident", do.center = F)
pbmc_liger  <- RunOptimizeALS(pbmc_liger, k = 30, lambda = 5, split.by = "orig.ident") ## this one takes a while
pbmc_liger  <- RunQuantileNorm(pbmc_liger, split.by = "orig.ident")
pbmc_liger  <- FindNeighbors(pbmc_liger,reduction = "iNMF",k.param = 10,dims = 1:30)
pbmc_liger  <- FindClusters(pbmc_liger)
pbmc_liger  <- RunUMAP(pbmc_liger, dims = 1:ncol(pbmc_liger[["iNMF"]]), reduction = "iNMF", verbose = F)
pbmc_liger  <- SetIdent(pbmc_liger,value = "orig.ident")
pL_I = DimPlot(pbmc_liger,reduction = "umap") + plot_annotation(title = "10k 3' PBMC and 10k 5' PBMC cells, after integration (LIGER)")
pL_I
pbmc_liger <- SetIdent(pbmc_liger,value = "seurat_clusters")
DimPlot(pbmc_liger,reduction = "umap",label = T, split.by = "orig.ident") + NoLegend()
pL = plot_integrated_clusters(pbmc_liger)
pL
grid.arrange(pS_B,pS_I, top = "SEURAT")
grid.arrange(pHL_B,pH_I, top = "HARMONY")
grid.arrange(pHL_B,pL_I, top = "LIGER")
# Seurat ARI
ariS <- dplyr::select(pbmc_seurat@meta.data, orig.ident, integrated_snn_res.0.8)
ariS$orig.ident <- plyr::mapvalues(ariS$orig.ident, from = c("pbmc10k_3p","pbmc10k_5p"), to = c(0, 1))
print("SEURAT ARI =")
print(adj.rand.index(as.numeric(ariS$orig.ident), as.numeric(ariS$integrated_snn_res.0.8)))
print("---------------")
# Harmony ARI
ariH <- dplyr::select(pbmc_harmony@meta.data, orig.ident, RNA_snn_res.0.8)
ariH$orig.ident <- plyr::mapvalues(ariH$orig.ident, from = c("pbmc10k_3p","pbmc10k_5p"), to = c(0, 1))
print("HARMONY ARI =")
print(adj.rand.index(as.numeric(ariH$orig.ident), as.numeric(ariH$RNA_snn_res.0.8)))
print("---------------")
# LIGER ARI
ariL <- dplyr::select(pbmc_liger@meta.data, orig.ident, RNA_snn_res.0.8)
ariL$orig.ident <- plyr::mapvalues(ariL$orig.ident, from = c("pbmc10k_3p","pbmc10k_5p"), to = c(0, 1))
print("LIGER ARI =")
print(adj.rand.index(as.numeric(ariL$orig.ident), as.numeric(ariL$RNA_snn_res.0.8)))
setwd("C:/Users/hopem/OneDrive/Desktop/Bhasin Lab/scToolbox")
getwd()
data = Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices.tar.gz")
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices.tar.gz")
GEOquery::gunzip("data/pbmc3k/filtered_gene_bc_matrices.tar.gz")
getwd()
ls()
data = Seurat::Read10X(data.dir = "data/pbmc3k_filtered_gene_bc_matrices.tar.gz")
GEOquery::gunzip("data/pbmc3k_filtered_gene_bc_matrices.tar.gz)
""
))
GEOquery::gunzip("data/pbmc3k_filtered_gene_bc_matrices.tar.gz")
untar("data/pbmc3k_filtered_gene_bc_matrices.tar")
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices/hg19/"")
}
}
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices/hg19/")
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices/hg19/")
loadExample = function(ex) {
if (ex == "3k") {
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices/hg19/")
} else {
print("dataset does not exist, available: 3k")
return(NULL)
}
obj = CreateSeuratObject(counts = data, project = ex, min.cells = 3, min.features = 200)
}
loadExample = function(ex) {
if (ex == "3k") {
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices/hg19/")
} else {
print("dataset does not exist, available: 3k")
return(NULL)
}
obj = CreateSeuratObject(counts = data, project = ex, min.cells = 3, min.features = 200)
return(obj)
}
test = loadExample("3k")
loadExample = function(ex) {
if (ex == "3k") {
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices/hg19/")
} else {
print("dataset does not exist, available: 3k")
return(NULL)
}
obj = Seurat::CreateSeuratObject(counts = data, project = ex, min.cells = 3, min.features = 200)
return(obj)
}
test = loadExample("3k")
test = loadExample("k")
loadExample = function(ex) {
if (ex == "3k") {
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices/hg19/")
} else {
print("dataset does not exist, available: 3k")
return(NULL)
}
obj = Seurat::CreateSeuratObject(counts = data, project = ex, min.cells = 3, min.features = 200)
return(obj)
}
test = loadExample("3k")
test
obj = test
obj$pred = scAnno(obj, type = "fine")
scAnno <- function(obj, type) {
hpca.se = celldex::HumanPrimaryCellAtlasData()
counts = GetAssayData(obj)
if (type == "fine") {
pred = SingleR::SingleR(test = counts, ref = hpca.se, assay.type.test = 1, labels = hpca.se$label.fine)
} else {
pred = SingleR::SingleR(test = counts, ref = hpca.se, assay.type.test = 1, labels = hpca.se$label)
}
return(pred)
}
obj$pred = scAnno(obj, type = "fine")
install.packages("celldex")
BiocManager::install("celldex")
obj$pred = scAnno(obj, type = "fine")
scAnno <- function(obj, type) {
hpca.se = celldex::HumanPrimaryCellAtlasData()
counts = Seurat::GetAssayData(obj)
if (type == "fine") {
pred = SingleR::SingleR(test = counts, ref = hpca.se, assay.type.test = 1, labels = hpca.se$label.fine)
} else {
pred = SingleR::SingleR(test = counts, ref = hpca.se, assay.type.test = 1, labels = hpca.se$label)
}
return(pred)
}
obj$pred = scAnno(obj, type = "fine")
loadExample = function(ex, norm = FALSE) {
if (ex == "3k") {
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices/hg19/")
} else {
print("dataset does not exist, available: 3k")
return(NULL)
}
obj = Seurat::CreateSeuratObject(counts = data, project = ex, min.cells = 3, min.features = 200)
if (norm) {
pbmc <- NormalizeData(pbmc)
pbmc <- FindVariableFeatures(pbmc)
pbmc <- ScaleData(pbmc)
} else {
return(obj)
}
}
obj = ladExample("3k", norm = TRUE)
obj = loadExample("3k", norm = TRUE)
#'
loadExample = function(ex, norm = FALSE) {
if (ex == "3k") {
data = Seurat::Read10X(data.dir = "data/obj3k/filtered_gene_bc_matrices/hg19/")
} else {
print("dataset does not exist, available: 3k")
return(NULL)
}
obj = Seurat::CreateSeuratObject(counts = data, project = ex, min.cells = 3, min.features = 200)
if (norm) {
obj <- Seurat::NormalizeData(obj)
obj <- Seurat::FindVariableFeatures(obj)
obj <- Seurat::ScaleData(obj)
} else {
return(obj)
}
}
obj = loadExample("3k", norm = TRUE)
setwd("C:/Users/hopem/OneDrive/Desktop/Bhasin Lab/scToolbox")
#' obj = loadExample("3k")
#'
loadExample = function(ex, norm = FALSE) {
if (ex == "3k") {
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices/hg19/")
} else {
print("dataset does not exist, available: 3k")
return(NULL)
}
obj = Seurat::CreateSeuratObject(counts = data, project = ex, min.cells = 3, min.features = 200)
if (norm) {
obj <- Seurat::NormalizeData(obj)
obj <- Seurat::FindVariableFeatures(obj)
obj <- Seurat::ScaleData(obj)
} else {
return(obj)
}
}
obj = loadExample("3k", norm = TRUE)
obj
loadExample = function(ex, norm = FALSE) {
if (ex == "3k") {
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices/hg19/")
} else {
print("dataset does not exist, available: 3k")
return(NULL)
}
obj = Seurat::CreateSeuratObject(counts = data, project = ex, min.cells = 3, min.features = 200)
if (norm) {
obj <- Seurat::NormalizeData(obj)
obj <- Seurat::FindVariableFeatures(obj)
obj <- Seurat::ScaleData(obj)
obj <- RunPCA(obj, features = VariableFeatures(object = obj))
obj <- FindNeighbors(obj, dims = 1:10)
obj <- FindClusters(obj, resolution = 0.5)
} else {
return(obj)
}
}
obj = loadExample("3k", norm = TRUE)
#' obj = loadExample("3k")
#'
loadExample = function(ex, norm = FALSE) {
if (ex == "3k") {
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices/hg19/")
} else {
print("dataset does not exist, available: 3k")
return(NULL)
}
obj = Seurat::CreateSeuratObject(counts = data, project = ex, min.cells = 3, min.features = 200)
if (norm) {
obj <- Seurat::NormalizeData(obj)
obj <- Seurat::FindVariableFeatures(obj)
obj <- Seurat::ScaleData(obj)
obj <- Seurat::RunPCA(obj, features = VariableFeatures(object = obj))
obj <- Seurat::FindNeighbors(obj, dims = 1:10)
obj <- Seurat::FindClusters(obj, resolution = 0.5)
} else {
return(obj)
}
}
obj = loadExample("3k", norm = TRUE)
#' obj = loadExample("3k")
#'
loadExample = function(ex, norm = FALSE) {
if (ex == "3k") {
data = Seurat::Read10X(data.dir = "data/pbmc3k/filtered_gene_bc_matrices/hg19/")
} else {
print("dataset does not exist, available: 3k")
return(NULL)
}
obj = Seurat::CreateSeuratObject(counts = data, project = ex, min.cells = 3, min.features = 200)
if (norm) {
obj <- Seurat::NormalizeData(obj)
obj <- Seurat::FindVariableFeatures(obj)
obj <- Seurat::ScaleData(obj)
obj <- Seurat::RunPCA(obj, features = Seurat::VariableFeatures(object = obj))
obj <- Seurat::FindNeighbors(obj, dims = 1:10)
obj <- Seurat::FindClusters(obj, resolution = 0.5)
} else {
return(obj)
}
}
obj = loadExample("3k", norm = TRUE)
obj
obj$SingleR = scAnno(obj, type = "broad")
obj
hpca.se = celldex::HumanPrimaryCellAtlasData()
counts = Seurat::GetAssayData(obj)
head(counts)
colnames(counts)
obj <- Seurat::RunUMAP(obj, dims = 1:10)
hpca.se
hpca.se$label.fine
pred = SingleR::SingleR(test = counts, ref = hpca.se, assay.type.test = 1, labels = hpca.se$label.fine)
scAnno <- function(obj, type) {
hpca.se = celldex::HumanPrimaryCellAtlasData()
counts = Seurat::GetAssayData(obj)
if (type == "fine") {
pred = SingleR::SingleR(test = counts, ref = hpca.se, assay.type.test = 1, labels = hpca.se$label.fine)
} else {
pred = SingleR::SingleR(test = counts, ref = hpca.se, assay.type.test = 1, labels = hpca.se$label.main)
}
return(pred)
}
#'
obj["label"] = scAnno(obj)
obj["label"] = scAnno(obj,"fine")
obj[["label"] = scAnno(obj,"fine")
obj[["label"]] = scAnno(obj,"fine")
